---
import SkillChip from "./SkillChip.astro";

interface Props {
  compact?: boolean;
  categories?: ("frontend" | "backend" | "devops")[];
}

const { compact = false, categories = ["frontend", "backend", "devops"] } = Astro.props;

// Updated colors to match Warm Craft palette
const skillCategories = {
  frontend: {
    title: "Frontend",
    skills: [
      { name: "React/Nextjs", color: "#61DAFB" },
      { name: "React Native", color: "#61DAFB" },
      { name: "Astro", color: "#c4704b" },
      { name: "TypeScript", color: "#3178C6" },
      { name: "GSAP", color: "#7d8471" },
      { name: "Tailwind CSS", color: "#06B6D4" },
    ],
  },
  backend: {
    title: "Backend",
    skills: [
      { name: "PHP Symfony", color: "#4a3c2a" },
      { name: "Rust", color: "#c4704b" },
      { name: "Go", color: "#00ADD8" },
      { name: "Node.js", color: "#7d8471" },
      { name: "Kotlin", color: "#c4704b" },
      { name: "PostgreSQL", color: "#4169E1" },
      { name: "REST", color: "#c4704b" },
      { name: "GraphQL", color: "#c4704b" },
    ],
  },
  devops: {
    title: "DevOps & Tools",
    skills: [
      { name: "Kubernetes", color: "#326CE5" },
      { name: "Docker", color: "#2496ED" },
      { name: "Google Cloud", color: "#4285F4" },
      { name: "Terraform", color: "#7d8471" },
      { name: "Expo", color: "#4a3c2a" },
      { name: "Git", color: "#c4704b" },
      { name: "Shell", color: "#7d8471" },
      { name: "Lua", color: "#2C39BD" },
      { name: "GNU/Linux", color: "#4a3c2a" },
      { name: "Github Actions", color: "#4a3c2a" },
    ],
  },
};

const selectedCategories = categories.map((cat) => ({
  key: cat,
  ...skillCategories[cat],
}));
---

<div class="skills-container" data-categorized-skills>
  {
    selectedCategories.map((category, index) => (
      <div class="skill-category" data-skill-category data-category-index={index}>
        <h3 class="category-title">{category.title}</h3>
        <SkillChip skills={category.skills} compact={compact} />
      </div>
    ))
  }
</div>

<style>
  .skills-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-l);
  }

  .skill-category {
    padding: var(--space-m);
    background: var(--wc-cream);
    border: 1px solid var(--wc-sand);
    border-radius: var(--radius-lg);
  }

  .category-title {
    font-family: var(--font-display);
    font-size: var(--text-body);
    font-weight: 600;
    color: var(--wc-bark);
    margin: 0 0 var(--space-s) 0;
    padding-bottom: var(--space-xs);
    border-bottom: 1px dashed var(--wc-sand);
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("astro:page-load", () => {
    const categories = document.querySelectorAll("[data-skill-category]");
    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    if (prefersReduced || !categories.length) return;

    categories.forEach((category, index) => {
      gsap.from(category, {
        opacity: 0,
        y: 20,
        rotation: index % 2 === 0 ? -1 : 1,
        duration: 0.6,
        ease: "power2.out",
        scrollTrigger: {
          trigger: category,
          start: "top 85%",
          toggleActions: "play none none none",
        },
      });
    });
  });
</script>
