---
interface Props {
  skills: Array<{ name: string; color: string }>;
  compact?: boolean;
}

const { skills, compact = false } = Astro.props;
---

<div
  data-skill-chips
  class:list={[
    "grid gap-2",
    compact
      ? "[grid-template-columns:repeat(auto-fill,minmax(130px,1fr))]"
      : "sm:gap-3 [grid-template-columns:repeat(auto-fit,minmax(160px,1fr))]",
  ]}
>
  {
    skills.map((s) => (
      <div
        data-chip
        title={s.name}
        style={`--c:${s.color}`}
        class:list={["skill-chip", compact ? "skill-chip--compact" : ""]}
      >
        <span class="skill-dot" aria-hidden="true" />
        <span class="skill-name">{s.name}</span>
        <span class="skill-sheen" />
      </div>
    ))
  }
</div>

<style>
  .skill-chip {
    position: relative;
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 0.625rem;
    height: 2.75rem;
    padding: 0 1rem;
    background: var(--wc-parchment);
    border: 1px solid var(--wc-sand);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-xs);
    overflow: hidden;
    cursor: default;
    transition:
      transform var(--duration-fast) var(--ease-bounce),
      box-shadow var(--duration-fast) var(--ease-smooth),
      border-color var(--duration-fast) var(--ease-smooth);
    will-change: transform;
  }

  .skill-chip--compact {
    height: 2.25rem;
    padding: 0 0.75rem;
    gap: 0.5rem;
  }

  .skill-chip:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: color-mix(in oklab, var(--c) 40%, var(--wc-sand));
  }

  .skill-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--c);
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--c) 20%, transparent);
    transition: box-shadow var(--duration-fast) var(--ease-smooth);
  }

  .skill-chip--compact .skill-dot {
    width: 6px;
    height: 6px;
  }

  .skill-chip:hover .skill-dot {
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--c) 30%, transparent);
  }

  .skill-name {
    font-family: var(--font-body);
    font-size: var(--text-small);
    font-weight: 500;
    color: var(--wc-ink);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .skill-chip--compact .skill-name {
    font-size: 0.8125rem;
  }

  .skill-sheen {
    position: absolute;
    inset: 0 auto 0 -35%;
    width: 35%;
    background: linear-gradient(
      90deg,
      transparent,
      color-mix(in oklab, var(--c) 10%, transparent),
      transparent
    );
    opacity: 0;
    transform: skewX(-20deg);
    pointer-events: none;
  }

  @media (prefers-reduced-motion: reduce) {
    [data-skill-chips] * {
      animation: none !important;
      transition: none !important;
    }
  }
</style>

<script>
  document.addEventListener("astro:page-load", async () => {
    const roots = document.querySelectorAll("[data-skill-chips]");
    if (!roots.length) return;

    const prefersReduced = matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (prefersReduced) return;

    const { gsap } = await import("gsap");

    roots.forEach((root) => {
      const chips = Array.from(root.querySelectorAll("[data-chip]")) as Array<HTMLElement>;

      gsap.from(chips, {
        y: 8,
        opacity: 0,
        duration: 0.4,
        stagger: 0.06,
        ease: "power2.out",
      });

      chips.forEach((chip) => {
        const sheen = chip.querySelector(".skill-sheen");

        chip.addEventListener("mouseenter", () => {
          if (sheen) {
            gsap.fromTo(
              sheen,
              { x: "-50%", opacity: 0 },
              {
                x: "150%",
                opacity: 1,
                duration: 0.5,
                ease: "power2.out",
                onComplete: () => {
                  gsap.to(sheen, { opacity: 0, duration: 0.15 });
                },
              }
            );
          }
        });
      });
    });
  });
</script>
