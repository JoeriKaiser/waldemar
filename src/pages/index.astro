---
import { getCollection, type CollectionEntry } from "astro:content";
import Jumbo from "../components/Jumbo/Jumbo.astro";
import Preview from "../components/ProjectTimeline/Preview.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

type Project = CollectionEntry<"project">;

const projects = await getCollection("project");
const activeProjects: Array<Project> = projects.filter((project) => project.data.isActive);

const sortedProjects = activeProjects.sort((a, b) => a.data.order - b.data.order);
---

<BaseLayout title="Joeri Kaiser">
  <main>
    <section class="container-wide min-h-[calc(100svh-120px)] py-[var(--space-2xl)]">
      <div transition:name="hero-section">
        <Jumbo />
      </div>
    </section>

    <section class="projects-section container-center">
      <header class="section-header">
        <h2 class="section-title">Selected Work</h2>
        <a href="#projects-list-start" class="btn btn-ghost">
          Jump to list
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 5v14M19 12l-7 7-7-7"></path>
          </svg>
        </a>
      </header>

      <a id="projects-list-start" class="sr-only">Projects list start</a>

      <div class="projects-list">
        {sortedProjects.map((project, index) => <Preview project={project} index={index} />)}
      </div>
    </section>
  </main>
</BaseLayout>

<script>
  document.addEventListener("astro:page-load", () => {
    try {
      const items = Array.from(document.querySelectorAll("[data-project-item]")).map((el) => {
        const id = el.getAttribute("id") || "";
        const title = el.querySelector("[data-project-title]")?.textContent || "";
        return { name: title.trim(), url: `/#${id}` };
      });
      window.__PROJECTS = items;
    } catch {}
  });
</script>

<style>
  .projects-section {
    padding-bottom: var(--space-3xl);
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-m);
    margin-bottom: var(--space-xl);
    flex-wrap: wrap;
  }

  .section-title {
    font-family: var(--font-display);
    font-size: var(--text-h2);
    font-weight: 600;
    color: var(--wc-ink);
    position: relative;
  }

  .section-title::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -4px;
    width: 60px;
    height: 3px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 4'%3E%3Cpath d='M0 2 Q5 0 10 2 T20 2' stroke='%23c4704b' stroke-width='2' fill='none'/%3E%3C/svg%3E")
      repeat-x;
    background-size: 20px 4px;
  }

  .projects-list {
    display: flex;
    flex-direction: column;
  }
</style>

<style is:global>
  ::view-transition-old(hero-section),
  ::view-transition-new(hero-section) {
    animation-duration: 0.5s;
  }
  ::view-transition-old(hero-section) {
    animation-name: scale-out;
  }
  ::view-transition-new(hero-section) {
    animation-name: scale-in;
  }
  @keyframes scale-out {
    to {
      transform: scale(0.95);
      opacity: 0;
    }
  }
  @keyframes scale-in {
    from {
      transform: scale(1.05);
      opacity: 0;
    }
  }
</style>
