---
import { getCollection, type CollectionEntry } from "astro:content";
import Jumbo from "../components/Jumbo/Jumbo.astro";
import Preview from "../components/ProjectTimeline/Preview.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

type Project = CollectionEntry<"project">;

const projects = await getCollection("project");
const activeProjects: Array<Project> = projects.filter((project) => project.data.isActive);

const sortedProjects = activeProjects.sort((a, b) => a.data.order - b.data.order);
---

<BaseLayout title="Joeri Kaiser">
  <main class="text-white">
    <section class="container-wide min-h-[calc(100svh-120px)] py-[var(--space-2xl)]">
      <div transition:name="hero-section">
        <Jumbo />
      </div>
    </section>

    <section class="container-center">
      <div class="flex items-center justify-between gap-4 mb-[var(--space-xl)]">
        <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-[var(--gray-1)]">
          Selected projects
        </h2>
        <a href="#projects-list-start" class="btn btn-ghost"> Jump to list </a>
      </div>

      <a id="projects-list-start" class="sr-only">Projects list start</a>
      <div class="flex flex-col gap-6">
        {sortedProjects.map((project) => <Preview project={project} />)}
      </div>
    </section>
  </main>
</BaseLayout>

<script>
  document.addEventListener("astro:page-load", () => {
    try {
      const items = Array.from(document.querySelectorAll(".project-timeline-item")).map((el) => {
        const id = el.getAttribute("id") || "";
        const title = el.querySelector(".project-title")?.textContent || "";
        return { name: title.trim(), url: `/#${id}` };
      });
      window.__PROJECTS = items;
    } catch {}
  });
</script>

<style is:global>
  ::view-transition-old(hero-section),
  ::view-transition-new(hero-section) {
    animation-duration: 0.5s;
  }
  ::view-transition-old(hero-section) {
    animation-name: scale-out;
  }
  ::view-transition-new(hero-section) {
    animation-name: scale-in;
  }
  @keyframes scale-out {
    to {
      transform: scale(0.95);
      opacity: 0;
    }
  }
  @keyframes scale-in {
    from {
      transform: scale(1.05);
      opacity: 0;
    }
  }
</style>
